!function(n){var r={};function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=1)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.commons={randomSort:function(){return Math.random()-.5},getRandom:function(e,t){return e-=.5,t+=.5,Math.round(Math.random()*(t-e)+e)},onEnterPress:function(e){return 13===e.keyCode},onEscPress:function(e){return 27===e.keyCode},onLeftPress:function(e){return 37===e.keyCode},onRightPress:function(e){return 39===e.keyCode}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filters=void 0;var o=n(2),i=n(5);t.filters=function(){var e=document.querySelector(".filters"),n=document.querySelector(".pictures"),t=void 0;function r(){var e=document.querySelector("input[name = filter]:checked").value,t={recommend:o.data.generatedPictures,popular:o.data.getPopularPictures(),discussed:o.data.getDicsussedPictures(),random:o.data.getRandomPictures()};n.innerHTML="",i.pictures.renderPictures(t[e])}return e.classList.remove("hidden"),e.addEventListener("change",function(){clearTimeout(t),t=setTimeout(function(){r()},300)}),{setPictureSort:r}}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.data=void 0;var r=n(0),o=n(3),i=t.data=function(){var e=[];e.slice();function t(){o.backend.downloadData(o.backend.onSuccess,o.backend.onError)}return t(),{generatedPictures:e,generatePictures:t,getPopularPictures:function(){return(e=i.generatedPictures.slice()).slice().sort(function(e,t){return t.likes-e.likes})},getDicsussedPictures:function(){return(e=i.generatedPictures.slice()).slice().sort(function(e,t){return t.comments.length-e.comments.length})},getRandomPictures:function(){return(e=i.generatedPictures.slice()).slice().sort(r.commons.randomSort)}}}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.backend=void 0;var r,o=n(1),i=n(2);t.backend={uploadForm:function(e,t){var n=new XMLHttpRequest;n.timeout=2e4,n.addEventListener("load",function(e){200!=e.target.status?t(e):alert("Данные успешно отправлены!")}),n.addEventListener("error",function(){alert("Ошибка передачи данных!")}),n.addEventListener("timeout",function(){alert("Сервер не ответил за "+n.timeout/1e3+" секунд!")}),n.open("POST","https://js.dump.academy/kekstagram"),n.send(e)},downloadData:function(t,n){var e=new XMLHttpRequest;e.timeout=2e4,e.addEventListener("load",function(e){if(200==e.target.status)return t(e);n(e)}),e.addEventListener("error",function(){alert("Ошибка загрузки данных!")}),e.addEventListener("timeout",function(){alert("Сервер не ответил за 20 секунд!")}),e.open("GET","https://js.dump.academy/kekstagram/data"),e.send()},onError:function(e){var t=e.target.status,n=e.target.statusText;alert("Ошибка "+t+" : "+n)},onSuccess:function(e){try{r=JSON.parse(e.target.responseText),i.data.generatedPictures.length=0,i.data.generatedPictures=r.slice(),o.filters.setPictureSort()}catch(e){alert("Непредвиденная ошибка "+e+" в данных :(")}},downloadedData:r=[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.form=void 0;var y=n(7),g=n(0),h=n(8),L=n(3);t.form=function(){var o=document.querySelector(".upload-form"),t=o.querySelector("#upload-file"),n=o.querySelector(".upload-overlay"),r=o.querySelector(".upload-form-description"),e=o.querySelector(".upload-resize-controls-button-dec"),i=o.querySelector(".upload-resize-controls-button-inc"),u=o.querySelector(".upload-resize-controls-value"),c=o.querySelector(".effect-image-preview"),a=o.querySelector(".upload-effect-controls"),s=n.querySelector(".upload-form-cancel"),l=o.querySelector(".effect-image-preview"),d=document.querySelector(".upload-effect-level");function f(){n.classList.add("hidden"),s.removeEventListener("click",f),document.removeEventListener("keydown",v),o.reset(),c.style="none"}function v(e){g.commons.onEscPress(e)&&r!==document.activeElement&&(e.preventDefault(),f())}o.setAttribute("action","https://js.dump.academy/kekstagram"),t.addEventListener("change",function(){if(y.validation.checkFileType(t)){var e=new FileReader;e.addEventListener("load",function(){l.src=e.result}),e.readAsDataURL(t.files[0]),d.classList.add("hidden"),n.classList.remove("hidden"),s.addEventListener("click",f),document.addEventListener("keydown",v)}else alert("Неверный тип файла! Допустимо использовать только .jpg или .png изображения!"),t.setCustomValidity("Неверный тип файла! Допустимо использовать только .jpg или .png изображения!")}),r.setAttribute("maxlength",140),u.value="100%";var m=parseInt(u.value,10);function p(){var e=h.slider.shift,t=o.querySelector("input[name=effect]:checked"),n=t.value,r={none:"none",chrome:"grayscale("+e/100+")",sepia:"sepia("+e/100+")",marvin:"invert("+e+"%)",phobos:"blur("+e/100*3+"px)",heat:"brightness("+e/100*3+")"};"none"!==n?d.classList.remove("hidden"):d.classList.add("hidden"),t.style.filter="none",c.style.filter=r[n]}return e.addEventListener("click",function(e){e.preventDefault(),25<m&&(m-=25),m<25&&(m=25);u.value=m+"%",c.style.transform="scale("+m/100+")"}),i.addEventListener("click",function(e){e.preventDefault(),m<100&&(m+=25),100<m&&(m=100);u.value=m+"%",c.style.transform="scale("+m/100+")"}),a.addEventListener("change",function(e){var t=e.target.value;h.slider.pin.style="none",h.slider.scaleActive.style="none",h.slider.shift=25,e.target.classList.add("filter-"+t),p()}),o.addEventListener("submit",function(e){e.preventDefault(),L.backend.uploadForm(new FormData(o),L.backend.onError),f()}),{uploadImageField:t,changeImageFilterValue:p}}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pictures=void 0;var o,i,r=n(6);n(4),t.pictures=(o=document.querySelector("#picture-template").content.querySelector(".picture"),(i=document.querySelector(".pictures")).addEventListener("click",r.gallery.openPopup),{renderPictures:function(e){var r=document.createDocumentFragment();e.forEach(function(e){var t,n;r.appendChild((t=e,(n=o.cloneNode(!0)).querySelector("img").src=t.url,n.querySelector(".picture-likes").textContent=t.likes,n.querySelector(".picture-comments").textContent=t.comments.length,n))}),i.appendChild(r)},picturesContainer:i})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.gallery=void 0;var g=n(0);t.gallery=function(){var t=document.querySelector(".gallery-overlay"),n=t.querySelector(".gallery-overlay-image"),r=t.querySelector(".likes-count"),o=t.querySelector(".comments-count"),i=t.querySelector(".gallery-overlay-close"),u=void 0,c=void 0,a=void 0;function s(e){e.preventDefault(),t.classList.add("hidden"),document.removeEventListener("keydown",l),i.removeEventListener("click",s),i.removeEventListener("keydown",d),t.removeEventListener("click",f),document.removeEventListener("keydown",p),document.removeEventListener("keydown",y)}function l(e){g.commons.onEscPress(e)&&(e.preventDefault(),s(e))}function d(e){g.commons.onEnterPress(e)&&s(e)}function f(e){e.preventDefault(),e.clientX>c?v():e.clientX<u&&m()}function v(){var e=void 0;e=a.parentNode===a.parentNode.parentNode.lastElementChild?a.parentNode.parentNode.firstElementChild:a.parentNode.nextSibling,n.src=e.querySelector("img").src,r.textContent=e.querySelector(".picture-likes").textContent,o.textContent=e.querySelector(".picture-comments").textContent,a=e.querySelector("img")}function m(){var e=void 0;e=a.parentNode===a.parentNode.parentNode.firstElementChild?a.parentNode.parentNode.lastElementChild:a.parentNode.previousSibling,n.src=e.querySelector("img").src,r.textContent=e.querySelector(".picture-likes").textContent,o.textContent=e.querySelector(".picture-comments").textContent,a=e.querySelector("img")}function p(e){e.preventDefault(),g.commons.onRightPress(e)&&v()}function y(e){e.preventDefault(),g.commons.onLeftPress(e)&&m()}return i.setAttribute("tabindex",0),{openPopup:function(e){e.preventDefault(),a=e.target,e.target.classList.contains("pictures")||(n.src=e.target.parentNode.querySelector("img").src,r.textContent=e.target.parentNode.querySelector(".picture-likes").textContent,o.textContent=e.target.parentNode.querySelector(".picture-comments").textContent,t.classList.remove("hidden"),u=n.getBoundingClientRect().left,c=n.getBoundingClientRect().right,document.addEventListener("keydown",l),i.addEventListener("click",s),i.addEventListener("keydown",d),t.addEventListener("click",f),document.addEventListener("keydown",p),document.addEventListener("keydown",y))}}}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i,u,c,a,s;t.validation=(o=document.querySelector(".upload-form-hashtags"),a={firstChar:"Хэштег должен начинаться с "+(c="#")+" !",splitter:"Хэштеги должны разделяться одним пробелом!",unique:"Хэштег должен быть уникальным!",tooMany:"Нельзя указать больше пяти хэштегов!",tooLong:"Максимальная длина хэштега - "+(i=20)+" символов",tooShort:"Минимальная длина хэштега - "+(u=2)+" символа",outline:"3px solid red;"},s=void 0,o.addEventListener("input",function(){var r=o.value.toLowerCase().trim().split(" ");clearTimeout(s),s=setTimeout(function(){var e,n,t;t="",(e=r).every(function(e){return e[0]===c})?(n=e).every(function(e,t){return n.indexOf(e)===t})?e.every(function(e){return e.length>=u})?e.every(function(e){return e.length<=i})?(o.style.outline="",t=""):(o.style.outline=a.outline,t=a.tooLong):(o.style.outline=a.outline,t=a.tooShort):(o.style.outline=a.outline,t=a.unique):(o.style.outline=a.outline,t=a.firstChar+" "+a.splitter),o.setCustomValidity(t)},2e3)}),{checkFileType:function(e){if(e.files[0]){var t=e.files[0].type.toLowerCase();return["image/jpeg","image/png"].some(function(e){return t===e})}return!1}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.slider=void 0;var a=n(4),s=t.slider=function(){var o=document.querySelector(".upload-effect-level-line"),i=o.querySelector(".upload-effect-level-pin"),u=o.querySelector(".upload-effect-level-val"),e=document.querySelector(".upload-effect-level"),c=25;function t(e){var t=o.getBoundingClientRect().right,n=o.getBoundingClientRect().left,r=e.clientX;t<r&&(r=t),r<n&&(r=n),c=parseInt(100*(r-n)/(t-n),10),s.shift=parseInt(100*(r-n)/(t-n),10),i.style.left=c+"%",u.style.width=c+"%",a.form.changeImageFilterValue()}function n(e){e.preventDefault(),document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",n)}return i.addEventListener("mousedown",function(e){e.preventDefault(),document.addEventListener("mousemove",t),document.addEventListener("mouseup",n)}),e.addEventListener("click",t),{shift:c,pin:i,scaleActive:u}}()}]);